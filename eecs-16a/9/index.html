<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="\(\) 03/29: Operational Amplifier and Comparator # Dependent Sources # As briefly mentioned before, the voltage and current sources covered so far have been independent sources, meaning they have a constant, fixed value. However, dependent sources also generate currents and voltages but their output depends on some other &ldquo;controlling&rdquo; current .$i_x$ or voltage .$v_x$ in the circuit.
VCVS: Voltage-controlled voltage source .$V = f_a (v_x)$ Unitless.$^1$ voltage gain .$a$ E."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="9: Op-Amps, Comparators & Charge Sharing"><meta property="og:description" content="\(\) 03/29: Operational Amplifier and Comparator # Dependent Sources # As briefly mentioned before, the voltage and current sources covered so far have been independent sources, meaning they have a constant, fixed value. However, dependent sources also generate currents and voltages but their output depends on some other &ldquo;controlling&rdquo; current .$i_x$ or voltage .$v_x$ in the circuit.
VCVS: Voltage-controlled voltage source .$V = f_a (v_x)$ Unitless.$^1$ voltage gain .$a$ E."><meta property="og:type" content="article"><meta property="og:url" content="http://notes.mehvix.com/eecs-16a/9/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-04-13T15:36:12-07:00"><title>9: Op-Amps, Comparators & Charge Sharing | notes.mehvix.com</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.89a77f7e702a8626749b948bbfb01109823daf6c1246ca407d1378833494c402.css integrity="sha256-iad/fnAqhiZ0m5SLv7ARCYI9r2wSRspAfRN4gzSUxAI=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.b26b5031dafcf6b906212e1f7aa55e910120a36166376ec0ec2fc03efaa64b0e.js integrity="sha256-smtQMdr89rkGIS4feqVekQEgo2FmN27A7C/APvqmSw4=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script>
<link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìì</text></svg>"><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script>MathJax={tex:{inlineMath:[["$","$"],[".$","$"]],processEscapes:!0,processEnvironments:!0,macros:{bigsup:["#1{^{\\vbox{\\hbox{$\\scriptstyle#1$}\\nointerlineskip\\hbox{}}}}",1],norm:[`\\left\\lVert#1\\right\\rVert`,1]}},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}}</script><script id=MathJax-script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.min.js?config=TeX-AMS_CHTML" integrity="sha512-9DkJEmXbL/Tdj8b1SxJ4H2p3RCAXKsu8RqbznEjhFYw0cFIWlII+PnGDU2FX3keyE9Ev6eFaDPyEAyAL2cEX0Q==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:".$",right:"$",display:!1},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><link rel=stylesheet href=http://notes.mehvix.com/css/custom_styling.css><div class=print style=text-align:center><h1 id=print-location>Notes can be found as interactive webpage at</h1></div><script>let a=document.createElement("a");a.appendChild(document.createTextNode(`notes.mehvix.com${window.location.pathname}`)),a.href="http://notes.mehvix.com"+window.location.pathname,document.getElementById("print-location").appendChild(a)</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>notes.mehvix.com</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-ad45289da5715225c5154e9ed2d01bfd class=toggle>
<label for=section-ad45289da5715225c5154e9ed2d01bfd class="flex justify-between"><a role=button>CS 194</a></label><ul><li><a href=http://notes.mehvix.com/cs-194/cs-194/>Main</a></li></ul></li><li><input type=checkbox id=section-381d9181c0cc4fe35fea10df5bf8d07d class=toggle>
<label for=section-381d9181c0cc4fe35fea10df5bf8d07d class="flex justify-between"><a role=button>MCB C61</a></label><ul><li><a href=http://notes.mehvix.com/mcb-c61/1/>1: Evolution of the Mind, the Brain, and Brain Chemistry</a></li><li><a href=http://notes.mehvix.com/mcb-c61/2/>2: DNA, Synapses, and Neuroanatomy</a></li><li><a href=http://notes.mehvix.com/mcb-c61/3/>3: Pharmacology; Neurodevelopment</a></li><li><a href=http://notes.mehvix.com/mcb-c61/4/>4: Sensory Perception</a></li><li><a href=http://notes.mehvix.com/mcb-c61/5/>5: Connectivity</a></li></ul></li><li><input type=checkbox id=section-254493c648c1f0be4cf9348c45ddbe37 class=toggle>
<label for=section-254493c648c1f0be4cf9348c45ddbe37 class="flex justify-between"><a role=button>CogSci C100</a></label><ul><li><a href=http://notes.mehvix.com/cogsci-c100/intro/>1: Introduction</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/perception/>2: Perception</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/non-visual/>3: Non-Visual Perception</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/attention/>4: Attention</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/sleep/>5: Sleep & Dreams</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/consciousness/>6: Consciousness</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/mindfulness/>7: Mindfulness</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/mem-process/>8: Memory Process</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/mem-strategies/>9: Memory Strategies</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/forgetting/>10: Forgetting & Reconstruction</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/mem-topics/>11: Memory Topics</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/imagery/>12: Imagery</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/language/>13: Language</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/problem/>14: Problem Solving, Creativity, & Decision Making</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/developement/>15: Cognitive Development</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/therapy/>16: Cognition & Therapy</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/ai-ml/>17: Artificial Intelligence & Machine Learning</a></li><li><a href=http://notes.mehvix.com/cogsci-c100/vr/>18: Virtual Reality</a></li></ul></li><li><input type=checkbox id=section-20c391324c82ffdef893b60d754b7005 class=toggle checked>
<label for=section-20c391324c82ffdef893b60d754b7005 class="flex justify-between"><a role=button>EECS 16A</a></label><ul><li><a href=http://notes.mehvix.com/eecs-16a/0/>0: System Design & Linear Equations</a></li><li><a href=http://notes.mehvix.com/eecs-16a/1/>1: Gaussian Elim. & Matrices + Vectors</a></li><li><a href=http://notes.mehvix.com/eecs-16a/2/>2: (In)dependence & Circuit Analysis</a></li><li><a href=http://notes.mehvix.com/eecs-16a/3/>3: Transformations & Inverse</a></li><li><a href=http://notes.mehvix.com/eecs-16a/4/>4: Vector Spaces & Eigenstuff</a></li><li><a href=http://notes.mehvix.com/eecs-16a/5/>5: Basis & Circuit Analysis</a></li><li><a href=http://notes.mehvix.com/eecs-16a/6/>6: Voltage Dividers & Measurement</a></li><li><a href=http://notes.mehvix.com/eecs-16a/7/>7: 2D Touchscreens & Superp. + Equivalence</a></li><li><a href=http://notes.mehvix.com/eecs-16a/8/>8: Capacitors & Capacitive Touchscreen</a></li><li><a href=http://notes.mehvix.com/eecs-16a/9/ class=active>9: Op-Amps, Comparators & Charge Sharing</a></li><li><a href=http://notes.mehvix.com/eecs-16a/10/>10: NFB, GRs & Buffer + Loading</a></li><li><a href=http://notes.mehvix.com/eecs-16a/11/>11: Locationing & Trilateration</a></li><li><a href=http://notes.mehvix.com/eecs-16a/12/>12-13: Least Squares & ML</a></li></ul></li><li><input type=checkbox id=section-7571d6f544c6ffc847948b0f74d82ef1 class=toggle>
<label for=section-7571d6f544c6ffc847948b0f74d82ef1 class="flex justify-between"><a role=button>Engineering 29</a></label><ul><li><a href=http://notes.mehvix.com/e-29/0/>0: Intro & Tolerancing</a></li><li><a href=http://notes.mehvix.com/e-29/1/>1: Fundamentals of Graphical Communication & Subtractive Processes</a></li><li><a href=http://notes.mehvix.com/e-29/2/>2: Cutting-based Processes & Other Subtractive Processes</a></li><li><a href=http://notes.mehvix.com/e-29/3/>3: Additive Processes: Intro & Extrusion</a></li><li><a href=http://notes.mehvix.com/e-29/4/>4: Additive Processes: Light-based, etc.</a></li><li><a href=http://notes.mehvix.com/e-29/5/>5-6: Forming Processes</a></li><li><a href=http://notes.mehvix.com/e-29/6/>6-7: Joining processes</a></li><li><a href=http://notes.mehvix.com/e-29/7/>7-9: Visualization</a></li><li><a href=http://notes.mehvix.com/e-29/10/>10: Metrology</a></li><li><a href=http://notes.mehvix.com/e-29/11/>11-12: GD&T</a></li></ul></li><li><a href=http://notes.mehvix.com/anthro-c12ac/>Anthro C12AC</a></li><li><a href=http://notes.mehvix.com/asamst-20a/>ASAMST 20A</a></li><li><input type=checkbox id=section-32aba3efd274a559b3dccd4e800c9d4b class=toggle>
<label for=section-32aba3efd274a559b3dccd4e800c9d4b class="flex justify-between"><a role=button>Math 53</a></label><ul><li><a href=http://notes.mehvix.com/math-53/10/>10: Parametric Equations and Polar Coordinates</a></li><li><a href=http://notes.mehvix.com/math-53/12/>12: Vectors & Geometry of Space</a></li><li><a href=http://notes.mehvix.com/math-53/13/>13: Vector Functions</a></li><li><a href=http://notes.mehvix.com/math-53/14/>14: Partial Derivatives</a></li><li><a href=http://notes.mehvix.com/math-53/15/>15: Multiple Integrals</a></li><li><a href=http://notes.mehvix.com/math-53/16/>16: Vector Calculus</a></li><li><a href=http://notes.mehvix.com/math-53/trig/>Trig Identities</a></li><li><a href=http://notes.mehvix.com/math-53/trig-calc/>Trig Calculus</a></li></ul></li><li><input type=checkbox id=section-98c46cabf82aecebcca8f97f2965f738 class=toggle>
<label for=section-98c46cabf82aecebcca8f97f2965f738 class="flex justify-between"><a role=button>Physics 7B</a></label><ul><li><a href=http://notes.mehvix.com/physics-7b/17/>17: Temperature, Thermal Expansion, & Ideal Gas Law</a></li><li><a href=http://notes.mehvix.com/physics-7b/18/>18: Kinetic Theory of Gases</a></li><li><a href=http://notes.mehvix.com/physics-7b/19/>19: Heat & First Law of Thermo</a></li><li><a href=http://notes.mehvix.com/physics-7b/20/>20: Second Law of Thermo</a></li><li><a href=http://notes.mehvix.com/physics-7b/21/>21: Electric Charges & Fields</a></li><li><a href=http://notes.mehvix.com/physics-7b/22/>22: Flux & Gauss's Law</a></li><li><a href=http://notes.mehvix.com/physics-7b/23/>23: Electric Potential</a></li><li><a href=http://notes.mehvix.com/physics-7b/24/>24: Capacitance, Dielectrics, Electric Energy Storage</a></li><li><a href=http://notes.mehvix.com/physics-7b/25/>25: Electric Current and Resistance</a></li><li><a href=http://notes.mehvix.com/physics-7b/26/>26: DC Circuits</a></li><li><a href=http://notes.mehvix.com/physics-7b/27/>27: Magnetism</a></li><li><a href=http://notes.mehvix.com/physics-7b/28/>28: Sources of Magnetic Field</a></li><li><a href=http://notes.mehvix.com/physics-7b/29/>29: Electromagnetic Induction & Faraday's Law</a></li><li><a href=http://notes.mehvix.com/physics-7b/30/>30: Inductance, Electromagnetic Oscillations, & AC Circuits</a></li></ul></li><li><input type=checkbox id=section-a18e6d23bfa638ffa382e954bd79207f class=toggle>
<label for=section-a18e6d23bfa638ffa382e954bd79207f class="flex justify-between"><a role=button>AP Notes</a></label><ul><li><a href=http://notes.mehvix.com/ap/huge/>AP Human Geography</a></li><li><a href=http://notes.mehvix.com/ap/cmech/>AP Physics C: Mechanics</a></li><li><a href=http://notes.mehvix.com/ap/stats/>AP Statistics</a></li></ul></li></ul><ul><li><a href=https://cs61a.rouxl.es/ target=_blank rel=noopener>CS61A (Anto's)</a></li><li><a href=# target=_blank rel=noopener>‚Äî</a></li><li><a href=https://www.mehvix.com target=_blank rel=noopener>w¬≥.mehvix.com</a></li><li><a href=https://pass.mehvix.com target=_blank rel=noopener>pass.mehvix.com</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>9: Op-Amps, Comparators & Charge Sharing</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#0329-operational-amplifier-and-comparator>03/29: Operational Amplifier and Comparator</a><ul><li><a href=#dependent-sources>Dependent Sources</a></li><li><a href=#op-amp>Op-Amp</a><ul><li><a href=#op-amp-as-a-comparator>Op-Amp as a Comparator</a></li></ul></li><li><a href=#comparator>Comparator</a><ul><li><a href=#capacitive-touchscreen-with-comparator>Capacitive Touchscreen with Comparator</a></li></ul></li></ul></li><li><a href=#0331-charge-sharing-and-negative-feedback>03/31: Charge Sharing and Negative Feedback</a><ul><li><a href=#charge-sharing>Charge Sharing</a><ul><li><a href=#algorithm>Algorithm</a></li><li><a href=#important-notes>Important Notes</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><link rel=stylesheet href=/katex/katex.min.css><script defer src=/katex/katex.min.js></script>
<script defer src=/katex/auto-render.min.js onload=renderMathInElement(document.body)></script><span>
\(\)</span><h1 id=0329-operational-amplifier-and-comparator>03/29: Operational Amplifier and Comparator
<a class=anchor href=#0329-operational-amplifier-and-comparator>#</a></h1><h2 id=dependent-sources>Dependent Sources
<a class=anchor href=#dependent-sources>#</a></h2><blockquote><p>As briefly mentioned before, the voltage and current sources covered so far have been independent sources, meaning they have a constant, fixed value. However,
<a href=https://en.wikipedia.org/wiki/Dependent_source>dependent sources</a> also generate currents and voltages but their output depends on some other &ldquo;controlling&rdquo; current .$i_x$ or voltage .$v_x$ in the circuit.</p></blockquote><p><div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><blockquote><p><strong>VCVS:</strong> Voltage-controlled voltage source
<img src=https://upload.wikimedia.org/wikipedia/commons/thumb/9/98/Voltage_controlled_voltage_source_circuit.svg/200px-Voltage_controlled_voltage_source_circuit.svg.png alt></p><ul><li>.$V = f_a (v_x)$</li><li><a href=https://en.wikipedia.org/wiki/Dimensionless_quantity>Unitless</a>.$^1$ voltage gain .$a$</li><li>E.x.
<a href=https://en.wikipedia.org/wiki/Amplifier#Ideal>Voltage amplifier</a></li><li>Input, output impedance: .$\infty, 0$</li></ul></blockquote><blockquote><p><strong>CCCS:</strong> Current-controlled current source
<img src=https://upload.wikimedia.org/wikipedia/commons/thumb/d/df/Current_controlled_current_source.svg/200px-Current_controlled_current_source.svg.png alt></p><ul><li>.$I = f_c (i_x)$</li><li><a href=https://en.wikipedia.org/wiki/Dimensionless_quantity>Unitless</a>.$^1$ voltage gain .$c$</li><li>E.x.
<a href=https://en.wikipedia.org/wiki/Amplifier#Ideal>Current amplifier</a></li><li>Input, output impedance: .$0, \infty$</li></ul></blockquote></div><div class="flex-even markdown-inner"><blockquote><p><strong>VCCS:</strong> Voltage-controlled current source
<img src=https://upload.wikimedia.org/wikipedia/commons/thumb/8/8e/Voltage_controlled_current_source.svg/200px-Voltage_controlled_current_source.svg.png alt></p><ul><li>.$I = f_b (v_x)$</li><li>Units:
<a href=https://en.wikipedia.org/wiki/Siemens_%28unit%29>Siemens</a>, .$S$; .$\Omega^{-1}, \mho$</li><li>E.x.
<a href=https://en.wikipedia.org/wiki/Transconductance>Transconductance</a> amplifier with conductance .$b$</li><li>Input, output impedance: .$\infty, \infty$</li></ul></blockquote><blockquote><p><strong>CCVS:</strong> Current-controlled voltage source
<img src=https://upload.wikimedia.org/wikipedia/commons/thumb/f/fc/Current_controlled_voltage_source.svg/200px-Current_controlled_voltage_source.svg.png alt></p><ul><li>.$V = f_d (i_x)$</li><li>Unit: Ohms</li><li>E.x.
<a href=https://en.wikipedia.org/wiki/Transconductance#Transresistance>Transresistor</a> with resistance .$d$</li><li>Input, output impedance: .$0, 0$</li></ul></blockquote></div></div>$^1$The proportionality constant between dependent and independent variables is unit/dimension-less if they are both currents (or both voltages)</p><h2 id=op-amp>Op-Amp
<a class=anchor href=#op-amp>#</a></h2><ul><li>An
<a href=https://en.wikipedia.org/wiki/Operational_amplifier>operational amplifier</a> (op-amp) is a device that transforms a small voltage difference into a very large voltage difference.</li><li>Made up of&mldr;<div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><ul><li>Two input terminals with potentials:<ul><li>$U_+$ (non-inverting) and</li><li>$U_-$ (inverting)</li><li><strong>Signal voltage</strong> = $\Delta U = U_+ - U_-$</li></ul></li><li>Two power supply terminals<ul><li>$V_{DD}$ (positive power supply) and</li><li>$V_{SS}$ (negative power supply)</li></ul></li><li>One output terminal with potential:<ul><li>$U_{out} \in [V_{SS}, V_{DD}]$</li></ul></li></ul></div><div class="flex-even markdown-inner"><blockquote><p><img src=/docs/eecs-16a/8/sym.png alt></p></blockquote></div></div></li></ul><div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><ul><li>We can model the op-amp behavior with the two VCVS circuit to the right<ul><li>Notice that no current is drawn from either power supply terminals so the behavior of the circuit shouldn&rsquo;t change</li></ul></li><li>$A$ is the internal signal
<a href=https://en.wikipedia.org/wiki/Gain_%28electronics%29>gain</a><ul><li>Unit-less quantity</li><li>The larger $A$, the sharper/quicker the transition between $V_{SS}$ and $V_{DD}$</li></ul></li></ul></div><div class="flex-even markdown-inner"><blockquote><p><img src=/docs/eecs-16a/8/op.png alt></p></blockquote></div></div><ul><li>With KVL we can find $U_{out}$:<ul><li>Except we can&rsquo;t have $U_{out} > V_{DD}$ or less than $V_{SS}$ so we end up <em>clipping</em> $U_{out}$ &ndash; this is called <strong>railing</strong>
$$U_{out} = V_{SS} + \frac{V_{DD} - V_{SS}}{2} + A \Delta U$$
$$\dots = \frac{V_{DD} + V_{SS}}{2} + A \Delta U$$
$$\dots = \begin{dcases}
V_{SS} & \frac{V_{DD} + V_{SS}}{2} + A \Delta U &lt; V_{SS} \\
V_{DD} & \frac{V_{DD} + V_{SS}}{2} + A \Delta U > V_{DD} \\
\frac{V_{DD} + V_{SS}}{2} + A \Delta U & \text{otherwise} \\
\end{dcases}$$<div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><ul><li><strong>Rail-determined offset:</strong> $\dfrac{V_{DD} + V_{SS}}{2}$<ul><li>$y$-intercept in $V_{out}, \Delta U$ graphs</li><li>Zero in NFB, that is
$$U_+ = U_-$$</li></ul></li></ul></div><div class="flex-even markdown-inner"><ul><li><strong>Signal gain:</strong> $A \Delta U = A (U_+ - U_-)$<ul><li>$A$ is the slope of the zone between rails</li><li>$A \approx \infty$ is a vertical line</li></ul></li></ul></div></div></li></ul></li></ul><h3 id=op-amp-as-a-comparator>Op-Amp as a Comparator
<a class=anchor href=#op-amp-as-a-comparator>#</a></h3><ul><li>The sign of the output will indicate which input voltage is larger.</li><li>We often want to know whether $V_?$ is smaller or larger than $V_{ref}$ so we&rsquo;ll set<ul><li>$ V_- = V_{ref}$ and $V_+ = V_?$</li></ul></li></ul><div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><ul><li>The blue region is the (super narrow, and in the ideal case, perfectly vertical) linear region where the input actually has &ldquo;space&rdquo; to be amplified without clipping<ul><li>For the vast majority of realistic inputs, the outputs sits at one of the rails (here, $V_{SS} = ‚àí2V$ and $V_{DD} = 3V$)</li></ul></li><li>In this way, the sign of the output directly gives the relationship between $V_{?}$ and $V_{ref}$</li><li>Note that with zero input difference, the output voltage ($y$-intercept) sits at the <strong>rail-offset</strong>: $\left(0, \dfrac{V_{DD} + V_{SS}}{2} \right) = (0, 0.5)$</li></ul></div><div class="flex-even markdown-inner"><p><img src=/docs/eecs-16a/8/blu.png alt></div></div><h2 id=comparator>Comparator
<a class=anchor href=#comparator>#</a></h2><div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><ul><li><strong><a href=https://en.wikipedia.org/wiki/Comparator>Comparator</a>:</strong> Enables us to take a <em>wonky</em> digital signal (i.e voltage) and convert it to a binary output signal<ul><li>Optimized for binary output and speed</li><li>Used in devices that measure and digitize analog signals i.e
<a href=https://en.wikipedia.org/wiki/Analog-to-digital_converter>ADCs</a>
<img src=/docs/eecs-16a/8/comps.png alt></li></ul></li></ul></div><div class="flex-even markdown-inner"><p>$$U_{out} = \begin{cases}
V_{DD} & U_+ > U_- \\
V_{SS} & U_+ &lt; U_- \\
\end{cases}$$
<img src=/docs/eecs-16a/8/comp.png alt></div></div><h3 id=capacitive-touchscreen-with-comparator>Capacitive Touchscreen with Comparator
<a class=anchor href=#capacitive-touchscreen-with-comparator>#</a></h3><h4 id=ac>AC
<a class=anchor href=#ac>#</a></h4><blockquote><p><figure><img src=/docs/eecs-16a/8/ac2.png></figure>See last weeks notes:
<a href=/eecs-16a/8/#ac>8: AC Source</a></p></blockquote><div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><ul><li>Because they are on the same node, we can observe $U_+ = V_C$ and $U_‚àí = V_{ref}$</li><li>The power sources are $V_{DD} = 3.3V$ and $V_{SS} = 0$, thus we can write the following:</li></ul></div><div class="flex-even markdown-inner"><p>$$V_{out} = \begin{cases}
3.3V & V_C > V_{ref} \\
0V & V_C &lt; V_{ref} \\
\end{cases}$$</div></div><ul><li>So how do we choose $V_{ref}$? We want our comparator to be high (on, $V_{out} = V_{DD}$) <em>depending</em> on touch (or lack thereof)<ul><li>Thus we should set $V_{ref}$ to be between the peak of $V_C$ with a finger and the peak of $V_C$ without a finger</li><li>To be fairly
<a href=https://en.wikipedia.org/wiki/Robustness>robust</a> to noise/error, $V_{ref}$ should be exactly between the two peaks:
$$V_{ref} = \frac{V_{C, touch} + V_{C, no\ touch}}{2} = \dots = \frac{1}{2} \frac{C_{eq} + \Delta C}{C_{eq} + C_{ref} + \Delta C}\frac{C_{eq}}{C_{eq}+C_{ref}}$$</li></ul></li></ul><div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><blockquote><p><img src=/docs/eecs-16a/8/peeks.png alt>
When there is a finger present, $V_C$ is always less than $V_{ref}$ so the output voltage is 0</p></blockquote></div><div class="flex-even markdown-inner"><blockquote><p><img src=/docs/eecs-16a/8/notouch.png alt>
Now every period of the current source cycle, $T$, we can measure if there is a finger touching this pixel</p></blockquote></div></div><h4 id=dc>DC
<a class=anchor href=#dc>#</a></h4><blockquote><p><img src=/docs/eecs-16a/8/dc.png alt></p><p>We can also use a DC voltage source too and end up with the same equation</p></blockquote><h1 id=0331-charge-sharing-and-negative-feedback>03/31: Charge Sharing and Negative Feedback
<a class=anchor href=#0331-charge-sharing-and-negative-feedback>#</a></h1><h2 id=charge-sharing>Charge Sharing
<a class=anchor href=#charge-sharing>#</a></h2><ul><li><strong>Floating node:</strong> Node out of or into which no charge can flow &ndash;
<a href=https://en.wikipedia.org/wiki/Virtual_ground>virtual ground</a><ul><li>We apply charge sharing to these nodes</li><li>If the sum of charges is 0 on a floating node, the sum of charges on that floating node at steady state will stay 0.</li><li>Examples:<ul><li>Nodes connected only to capacitor plates</li><li>Nodes connected only to op-amp inputs or comparator inputs</li></ul></li></ul></li><li>Notation:<ul><li>In each phase, the circuit has a different configuration by opening/closing different switches.</li><li>Generally, a switch labeled $\phi_i (i = 1,2,3, \dots)$ will be <em>closed</em> in phase $i$ and <em>open</em> in all other phases.<ul><li>Switches labeled $\phi_1$ will be <em>closed</em> in phase 1 and <em>open</em> in phase 2,</li><li>Switches labeled $\phi_2$ will be <em>open</em> in phase 1 and <em>closed</em> in phase 2.</li></ul></li></ul></li></ul><h3 id=algorithm>Algorithm
<a class=anchor href=#algorithm>#</a></h3><h4 id=step-1>Step 1
<a class=anchor href=#step-1>#</a></h4><blockquote><p><img src=/docs/eecs-16a/9/base.png alt>
<strong>Label the voltages</strong> across all the capacitors. Choose whichever direction (polarity) you want for each capacitor - this means you can mark any one of the plates with the ‚Äú+‚Äù sign, and then you can mark the other plate with the ‚Äú‚àí‚Äù sign. <strong>Make sure you stay consistent with this polarity across phases.</strong></p></blockquote><h4 id=step-2>Step 2
<a class=anchor href=#step-2>#</a></h4><blockquote><p><strong>Draw the equivalent circuit during both phases.</strong> For this problem, phase 1: $\phi_1$ closed, $\phi_2$ open, and phase 2: $\phi_1$ open, $\phi_2$ closed. Also, <strong>label all node voltages</strong> on the circuit for both phases. No need to try and maintain the same names, since certain nodes of the phase 1 circuit might be merged or split in phase 2.<div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><p>$\phi_1$
<img src=/docs/eecs-16a/9/p1.png alt></div><div class="flex-even markdown-inner"><p>$\phi_2$
<img src=/docs/eecs-16a/9/p2.png alt></div></div></p></blockquote><h4 id=step-3>Step 3
<a class=anchor href=#step-3>#</a></h4><blockquote><p><strong>Identify all ‚Äúfloating‚Äù nodes</strong> in your circuit during phase 2. You can identify those nodes as the nodes connected only to capacitor plates, op-amp inputs or comparator inputs. These will be the nodes where we apply charge sharing.</p><p>In this case the only node that is floating during phase 2 is node $u_3$. (Node $u_2$ is connected to the voltage source, i.e. $u_2 = V_S$, and the 3rd node is the ground node)</p></blockquote><h4 id=step-4>Step 4
<a class=anchor href=#step-4>#</a></h4><blockquote><p>For steps 4-6 we will <strong>examine each phase 2 floating node individually</strong>. Pick a floating node from the ones you found in step 3 and identify all capacitor plates connected to that node during phase 2. Then, calculate the charge on each of these plates in the steady state of phase 1. To do so, identify all nodes in your circuit during phase 1. Label all node voltages, and write the voltages <em>across</em> each capacitor as functions of node voltages (step 2 should help you with that). Do this according to the polarities you have selected. Then the charge is found as $Q = CV_C$ (where $V_C$ is the voltage <em>across</em> a capacitor).<blockquote class="book-hint danger"><ul><li><strong>Careful:</strong> The plate marked with the ‚Äú‚àí‚Äù sign will have $Q = -CV_C$ and the plate marked with the ‚Äú+‚Äù sign will have $Q = CV_C$ stored onto them.</li><li><strong>Careful:</strong> We assume here that you know all node voltages during phase 1. If you don‚Äôt, before starting this procedure calculate the node voltages you need using one of the previously introduced circuit analysis techniques (most likely KVL).</li></ul></blockquote><div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><p>Looking at our single floating node we can see that the ‚Äú+‚Äù plates of $C_1$ and $C_2$ are connected to it during phase 2. Let‚Äôs calculate the charge on these plates connected to the floating node $u_3$ during <strong>phase $\phi_1$, denoted $Q_{u3}^{\phi 1}$</strong></div><div class="flex-even markdown-inner"><br><p>$$Q_{u3}^{\phi 1} = V_1^{\phi 1} C_1 + V_2^{\phi 1} C_2 $$
$$\dots = (V_S - 0)C_1 + 0$$
$$\dots = V_S C_1$$</div></div></p></blockquote><h4 id=step-5>Step 5
<a class=anchor href=#step-5>#</a></h4><blockquote><div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><p><strong>Find the total charge on each of the floating nodes</strong> in the steady state of phase 2 as a function of node voltages using the same process as Step 4. Make sure you kept the polarity same and pay attention to the sign of each plate.</div><div class="flex-even markdown-inner"><br><p>$$Q_{u3}^{\phi 2} = V_1^{\phi 2} C_1 + V_2^{\phi 2} C_2 $$
$$\dots = (u_3 - u_2)C_1 + (u_3 - 0)C_2$$
$$\dots = (u_3 - V_S)C_1 + u_3 C_2$$</div></div></blockquote><h4 id=step-6>Step 6
<a class=anchor href=#step-6>#</a></h4><blockquote><div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><p><strong>Apply conservation of charge.</strong> The charge in the steady state of phase 1 we calculated in Step 4, $Q_{u3}^{\phi 1}$, is the initial charge of phase 1. Charge must be conserved at a floating node, so the steady state charge of phase 2, $Q_{u3}^{\phi 2}$, should equal the
initial charge $Q_{u3}^{\phi 1}$. We can then write in terms of the unknown(s).</div><div class="flex-even markdown-inner"><br><p>$$Q_{u3}^{\phi 1} = Q_{u3}^{\phi 2} $$
$$V_S C_1 = (u_3 - V_S)C_1 + u_3 C_2 $$
$$u_3 = \frac{2C_1}{C_1 + C_2}V_S$$</div></div></blockquote><h4 id=step-7>Step 7
<a class=anchor href=#step-7>#</a></h4><blockquote><div class="book-columns flex flex-wrap"><div class="flex-even markdown-inner"><p><strong>Repeat steps 4-6 for every floating node</strong>. This will give you one equation per floating node (i.e. if you have $m$ floating nodes you will have $m$ equations). You can then solve the system of equations to find the node voltages during phase 2 (unknowns).</p><p>In this problem we did not go through step 7 since we only had one floating node during phase 2. This means we have only one unknown node voltage ($u_3$) for which we solved using our single equation from Step 6.
<a href="https://eecs16a.org/lecture/Note17B.pdf#page=4">Example 2 on page 4</a> has multiple floating nodes.</p></div></div></blockquote><h3 id=important-notes>Important Notes
<a class=anchor href=#important-notes>#</a></h3><blockquote><ol><li>A node that is floating during phase 2 is not necessarily floating during phase 1. In fact, it could have been two separate nodes during phase 1 depending on how your switches are configured. We only care about the floating nodes during phase 2 since those are the nodes with unknown voltages. What about floating nodes during phase 1? You should be able to calculate the voltage of these nodes based on the initial condition of the circuit and the circuit techniques that you have learned so far (most likely KVL).</li><li>When handling charge sharing problems you should avoid using any parallel or series capacitance formulae that you have learned. Any simplification of the circuit might lead to mistakes since the circuit in different phases is configured differently and some capacitors placed in series during one phase may be in parallel or even not connected at all in another phase!</li></ol></blockquote></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/Mehvix/notes/commit/d847a52ca9b04905ba39f394cde32c520585dbe7 title='Last modified by Max Vogel | April 13, 2022' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>April 13, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/Mehvix/notes/edit/master/hugo/content/docs/eecs-16a/9.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#0329-operational-amplifier-and-comparator>03/29: Operational Amplifier and Comparator</a><ul><li><a href=#dependent-sources>Dependent Sources</a></li><li><a href=#op-amp>Op-Amp</a><ul><li><a href=#op-amp-as-a-comparator>Op-Amp as a Comparator</a></li></ul></li><li><a href=#comparator>Comparator</a><ul><li><a href=#capacitive-touchscreen-with-comparator>Capacitive Touchscreen with Comparator</a></li></ul></li></ul></li><li><a href=#0331-charge-sharing-and-negative-feedback>03/31: Charge Sharing and Negative Feedback</a><ul><li><a href=#charge-sharing>Charge Sharing</a><ul><li><a href=#algorithm>Algorithm</a></li><li><a href=#important-notes>Important Notes</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>